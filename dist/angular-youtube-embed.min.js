/*
  angular-youtube-mb v1.0.2
  https://github.com/brandly/angular-youtube-embed
*/
angular.module("youtube-embed",["ng"]).service("youtubeEmbedUtils",["$window","$rootScope",function(e,t){function r(e,t){return e.indexOf(t)>-1}function i(){t.$apply(function(){a.ready=!0})}var a={},n=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:-nocookie)?\.com\S*[^\w\s-])([\w-]{11})(?=[^\w-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,d=/t=(\d+)[ms]?(\d+)?s?/;return a.getIdFromURL=function(e){var t=e.replace(n,"$1");if(r(t,";")){var i=t.split(";");if(r(i[1],"%")){var a=decodeURIComponent(t.split(";")[1]);t=("http://youtube.com"+a).replace(n,"$1")}else t=i[0]}else r(t,"#")&&(t=t.split("#")[0]);return t},a.getTimeFromURL=function(e){e=e||"";var t=e.match(d);if(!t)return 0;var i=t[0],a=t[1],n=t[2];return"undefined"!=typeof n?(n=parseInt(n,10),a=parseInt(a,10)):r(i,"m")?(a=parseInt(a,10),n=0):(n=parseInt(a,10),a=0),n+60*a},a.ready=!1,"undefined"==typeof YT?e.onYouTubeIframeAPIReady=i:YT.loaded?a.ready=!0:YT.ready(i),a}]).directive("youtubeVideo",["youtubeEmbedUtils","$parse","$compile","$q",function(e,t,r,i){var a=1,n={"-1":"unstarted",0:"ended",1:"playing",2:"paused",3:"buffering",5:"queued"},d="youtube.player.";return{restrict:"EA",scope:{videoId:"=?",videoUrl:"=?",player:"=?",playerVars:"=?",playerHeight:"=?",playerWidth:"=?"},link:function(o,l,u){function p(){var e=Array.prototype.slice.call(arguments);o.$apply(function(){o.$emit.apply(o,e)})}function y(e){var t=n[e.data];"undefined"!=typeof t&&p(d+t,o.player,e),o.$apply(function(){o.player.currentState=t})}function c(e){p(d+"ready",o.player,e),g.resolve()}function s(e){p(d+"error",o.player,e)}function f(){var e=angular.copy(o.playerVars);e.start=e.start||o.urlStartTime;var t=new YT.Player(b,{height:o.playerHeight,width:o.playerWidth,videoId:o.videoId,playerVars:e,events:{onReady:c,onStateChange:y,onError:s}});return t.id=b,t}function v(){(o.videoId||o.playerVars.list)&&(o.player&&"function"==typeof o.player.destroy&&o.player.destroy(),o.player=f())}var g=i.defer(),m=l,h=t(u.startWithImage)();if(h===!0){m=angular.element("<div></div>");var I=r(angular.element('<div ng-show="imageClicked"></div>'))(o),$=r(angular.element('<div class="image-wrapper" ng-hide="imageClicked" ng-click="imageClick()"><img ng-src="http://img.youtube.com/vi/{{videoId}}/0.jpg" ng-style="{ \'height\': playerHeight + \'px\' }"><div></div></div>'))(o);I.append(m),l.append(I),l.append($)}o.playerHeight=o.playerHeight||390,o.playerWidth=o.playerWidth||640,o.playerVars=o.playerVars||{},o.utils=e;var b=u.playerId||l[0].id||"unique-youtube-embed-id-"+a++;m[0].id=b,o.imageClick=function(){o.imageClicked=!0,g.promise.then(function(){o.player.playVideo()})};var w=o.$watch(function(){return o.utils.ready&&("undefined"!=typeof o.videoUrl||"undefined"!=typeof o.videoId||"undefined"!=typeof o.playerVars.list)},function(e){e&&(w(),"undefined"!=typeof o.videoUrl?o.$watch("videoUrl",function(e){o.videoId=o.utils.getIdFromURL(e),o.urlStartTime=o.utils.getTimeFromURL(e),v()}):"undefined"!=typeof o.videoId?o.$watch("videoId",function(){o.urlStartTime=null,v()}):o.$watch("playerVars.list",function(){o.urlStartTime=null,v()}))});o.$watchCollection(["playerHeight","playerWidth"],function(){o.player&&o.player.setSize(o.playerWidth,o.playerHeight)}),o.$on("$destroy",function(){o.player&&o.player.destroy()})}}}]);